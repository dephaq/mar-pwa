MAR PWA — План разработки продукта (v1)
================================================

Цель
----
Создать PWA-приложение «MAR» для респондентов маркетинговых исследований: сбор профиля и прескрина, участие в опросах, персональные приглашения, награды; для исследователей — админ-панель с таргетингом и квотами, рассылка приглашений и контроль качества.

1) Видение и KPI
----------------
- Респондент быстро устанавливает PWA, заполняет профиль/прескрин и получает персональные приглашения.
- Исследователь запускает исследования, таргетирует аудиторию и закрывает квоты в срок.
- Ключевые метрики: установки PWA, enable rate уведомлений iOS/Android, % заполненных профилей, конверсия приглашение→старт→завершение, время закрытия квот, стоимость респондента, доля «mismatch».

2) Дизайн-система (UI/UX)
-------------------------
Навигация и макет
- Мобильный: верхний бар 44–48 px, гамбургер → выезжающее меню; опциональный нижний тулбар на 3–4 раздела.
- Планшет/десктоп: постоянный левый сайдбар (drawer) + контент; адаптивная сетка 4/8/12 колонок.
- Safe-area (iOS): паддинги с использованием env(safe-area-inset-*) и защита от «вылета» контента под жесты.
- Темы: светлая/тёмная; поддержка prefers-color-scheme.

Визуальная идентика
- Логотип «M»; иконки 192/512 + apple-touch-icon с минимальными полями (логотип крупнее).
- Основной цвет — фирменный синий, акцент — бирюзовый/лаймовый, нейтральные серые 50/100/300/600.
- Типографика: базовый 16–18 px, заголовки 24–28 px, межстрочный 1.4–1.6, контраст WCAG AA+.

Состояния/поведение
- Skeleton-лоадеры, пустые состояния, inline-ошибки, «сохранено» (toast).
- Микроанимации: плавные переходы, без резких сдвигов.

Контент и копирайтинг
- Короткие заголовки («Исследования», «Награды», «Профиль», «Поддержка»).
- Понятные CTA («Принять участие», «Включить уведомления», «Обновить прескрин»).
- Ясные тексты согласий и приватности.

3) Пользовательские флоу респондента
------------------------------------
A. Первый запуск и согласия
- Экран приветствия; согласие на обработку данных; ссылка на политику.
- Подсказка «Добавить на экран Домой» (iOS/Android), затем кнопка «Включить уведомления» (по клику).

B. Профиль и прескрининг
- Профиль: имя, возраст, пол, город, профессия, контакты (email/телефон по желанию), интересы.
- Прескрин: тематические блоки (медицина/ритейл/авто и т.д.), версионирование, дата обновления.
- Валидация прескрина при входе в анкету (дублирование ключевых вопросов).

C. Лента приглашений
- Карточки: тема, длительность, вознаграждение, дедлайн; кнопки «Детали»/«Принять».
- Фильтры: скрыть неподходящие; сортировка по дедлайну.

D. Прохождение анкет
- MVP: встраивание анкеты по ссылке (iframe); далее — нативные формы с логикой.
- Отслеживание статуса: начат/завершён/скрин-аут/отказ.

E. Награды и история
- Баланс, «в ожидании», «начислено», история транзакций; подсказки по выводу средств.

F. Коммуникации
- Web Push подписка (через кнопку) и получение приглашений; переход по клику в нужное исследование.

4) Личный кабинет (разделы и экраны)
------------------------------------
- Главная: актуальные приглашения, быстрые фильтры, плашка включения уведомлений.
- Мои исследования: активные/завершённые, статусы, даты, ссылок на чеки/выплаты.
- Профиль: персональные данные, прескрин-анкеты, интересы, язык/тема, согласия, удаление аккаунта.
- Награды: баланс, транзакции, правила начисления, способы вывода (этап 2).
- Поддержка: FAQ, форма обращения/чат, SLA ответа.

5) Админ-панель (оператор/исследователь)
----------------------------------------
- Дашборд: активные исследования, набор/прогресс, конверсия, среднее время, расходы.
- Исследования:
  * создание карточки (тема, ссылка, длительность, вознаграждение, дедлайн);
  * таргетинг по прескринам и профилю;
  * квоты/страты (пол/возраст/регион/доход и т. п.);
  * публикация карточки и кампания приглашений (push/e-mail), лимит частоты, дедупликация.
- Аудитория: поиск респондентов, сегменты, экспорт/импорт прескринеров.
- Качество: дубли/скорость/контрольные вопросы, «mismatch» прескрин vs анкета, логи.
- Выплаты: правила начислений, статусы, отчёты, выгрузки для фин. систем.
- Настройки: тексты согласий, политика хранения, RBAC-роли, VAPID-ключи, интеграции.
- Аудит-лог: кто, что и когда изменял.

6) Алгоритм подбора исследований
--------------------------------
1) Фильтр соответствия по профилю/прескринам.  
2) Квоты/страты: резерв слотов по слоям.  
3) Очередь приглашений: приоритет по активности/надёжности + cooldown.  
4) Валидация: при расхождении ответов — отметка «mismatch», исключение из квоты, запрос актуализации.

7) Архитектура и стек
---------------------
Фронтенд (PWA)
- React/Vite (или ваш стек), TanStack Router, TypeScript, Workbox, IndexedDB для кэша.
- Service Worker: офлайн-кэш, маршрутизация, обработчик push, клики уведомлений.
- Доступность: aria-метки, tabindex, контраст; Lighthouse ≥ 90.

Бэкенд/интеграции
- Node.js (NestJS/Express) или Python (FastAPI).
- PostgreSQL + Redis (очереди/сессии).
- Web Push сервер (VAPID), e-mail (SES/Postmark).
- Сущности: User, Profile, Consent, PrescreenerAnswer, Study, Invitation, Participation, Reward, DeviceSubscription, AuditEvent.
- API: REST/GraphQL; webhooks для статусов анкет.

Развёртывание
- Фронт: GitHub Pages/Cloudflare Pages.
- Бэкенд: Vercel/Render/Fly/Cloudflare Workers.
- CI/CD: GitHub Actions (lint, test, build, deploy).

8) GDPR/Безопасность
--------------------
- Правовая основа: согласие/легитимный интерес; журнал согласий.
- Права субъектов: выгрузка, удаление, исправление; SLA обработки запросов.
- Минимизация и сроки хранения; псевдонимизация.
- Безопасность: HTTPS, CSP, шифрование PII в БД, RBAC и 2FA для админов, аудит-логи.
- Cookie-баннер и центр предпочтений.

9) Дорожная карта (MVP → Core → Growth)
---------------------------------------
Этап A — MVP (2–4 недели)
- PWA (домой/офлайн/safe-area), профиль + базовые прескрины, лента приглашений (ручной импорт), анкеты в iframe, история участия, подписка Web Push, рассылка «новое исследование», простая админка: создать исследование, таргетинг, отправка приглашений, экспорт CSV. Тесты на iOS/Android.

Этап B — Core (4–8 недель)
- Квоты и стратификация, матчинговый движок, валидация прескрина в анкете, сегменты, награды/выплаты, роли (оператор/админ), дашборды, качество и антифрод-сигналы.

Этап C — Growth (8–12 недель)
- Нативные формы с условной логикой, A/B-тесты приглашений, локализация, рефералка, SSO для исследователей, API/вебхуки, расширенный антифрод.

10) Критерии готовности к запуску
---------------------------------
- Пройдено UX-тестирование (≥5 респондентов), устранены критические проблемы.
- Lighthouse ≥ 90 (PWA/Performance/Best Practices/Accessibility).
- Политики приватности и согласий опубликованы; DPA с подрядчиками.
- Набор тестовой квоты с реальными респондентами: конверсия, SLA, время закрытия.
- Процессы саппорта и выплат проверены на пилоте.
